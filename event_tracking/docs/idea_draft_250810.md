                                +------------------------------------+
                                |         SaaS Tenant Portal        |
                                +----------------+-------------------+
                                                 |
                                      +----------v-----------+
                                      |   API Gateway Layer   |
                                      +----+--------+--------+
                                           |        |
        +----------------------------------+        +-------------------------------+
        |                                                                               |

+-------v--------+ +------------v------------+
| Tracking Service |<-- JS SDKã€Mobile SDK | Workflow Orchestrator |
+--------+--------+ +------------+------------+
| |
v v
+--------v--------+ +-----------------------+ +----------------------+ +---------------+
| Event Preprocessor| -->| Customer Data Platform |<-->| CRM Service |--> | AI Agent |
+--------+--------+ +-----------------------+ +----------------------+ +---------------+
| |
v |
+--------v----------------+ |
| Global Behavior DB | <------+
| (Anonymized Event DB) |
+--------+----------------+
|
v
+-----------------------------+
| Global Behavior Analyzer | <-- å…¨ç§Ÿæˆ¶åŒ¿åäº‹ä»¶å»ºæ¨¡ / èšé¡ž / è¡Œç‚ºé—œè¯åˆ†æž
| - Profile Pattern Mining |
| - è¡Œç‚ºèšé¡ž (Clustering) |
| - å°æ‡‰è§¸ç™¼ç­–ç•¥æŠ½å– |
+-----------------------------+
|
v
+-----------------------------+
| Recommendation Engine | <-- æä¾›ç§Ÿæˆ¶å¯ç”¨å»ºè­°ï¼Œä¸å¯å›žæŸ¥åŽŸè³‡æ–™
| - æœ€ä½³æ–‡æ¡ˆæ¨¡æ¿å»ºè­° |
| - è¡ŒéŠ·æŽ¨æ’­æ™‚é–“é æ¸¬å»ºè­° |
| - åˆ†ç¾¤æŽ¨è–¦ç­–ç•¥ |
+-----------------------------+
|
v
+------------------------------+
| Tenant-specific AI API |
| /v1/insights/recommendation |
+------------------------------+

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway / BFF â”‚ (Auth + API Routing)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Authentication â”‚â”€â”€â” <â€” ç™»å…¥ã€Token ç®¡ç†ã€OAuthã€ç§Ÿæˆ¶èªè­‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Core Services â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â–¼ â–¼ â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tenant â”‚ â”‚ Event â”‚ â”‚ Profile â”‚
â”‚ Management â”‚ â”‚ Collector â”‚ â”‚ Service â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç§Ÿæˆ¶ç®¡ç† æŽ¥æ”¶å‰ç«¯ SDK è³‡æ–™ å»ºç«‹ç”¨æˆ¶è¡Œç‚ºèˆ‡å±¬æ€§é—œè¯

       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                                â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Identity Graph â”‚ â”‚ Consent Manager â”‚
â”‚ æœå‹™é–“ç”¨æˆ¶é—œè¯ â”‚ â”‚ åŒæ„æ¢æ¬¾èˆ‡è³‡æ–™æŽˆæ¬Š â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                                     â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Behavior Analytics â”‚ â”‚ Recommendation Engine â”‚
â”‚ å³æ™‚/æ‰¹æ¬¡è¡Œç‚ºåˆ†æž â”‚ â”‚ è¡Œç‚ºæ¨¡åž‹ + æŽ¨è–¦æ¨¡åž‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                             â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Notification Service â”‚ â”‚ Audit & Compliance â”‚
â”‚ æŽ¨æ’­/Email é€šçŸ¥æœå‹™ â”‚ â”‚ è¨˜éŒ„è³‡æ–™å–ç”¨/æ¨¡åž‹ç´€éŒ„ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

| å¾®æœå‹™åç¨±                    | æè¿°èˆ‡è²¬ä»»                                                          | è³‡æ–™ä¾è³´ / è¼¸å‡º                |
| ----------------------------- | ------------------------------------------------------------------- | ------------------------------ |
| **API Gateway / BFF**         | å°å¤–çµ±ä¸€å…¥å£ï¼Œè™•ç† API è·¯ç”±ã€Token é©—è­‰ã€ç§Ÿæˆ¶è­˜åˆ¥ã€CORSã€é€ŸçŽ‡é™åˆ¶   | æ‰€æœ‰å¤–éƒ¨æœå‹™èˆ‡ SDK             |
| **Authentication Service**    | è² è²¬ç§Ÿæˆ¶èˆ‡ç”¨æˆ¶èº«ä»½é©—è­‰ï¼Œæ”¯æ´ OAuth2/JWTï¼ŒSSO                        | Tokenã€User Sessionã€Tenant ID |
| **Tenant Management Service** | å»ºç«‹ç§Ÿæˆ¶ã€æ¨¡çµ„è¨­å®šã€è³‡æ–™å„²å­˜å€éš”ï¼ˆPostgres Schema / DB per Tenantï¼‰ | ç§Ÿæˆ¶è¨­å®šã€é…é¡ã€å•Ÿç”¨æ¨¡çµ„       |
| **Event Collector Service**   | æŽ¥æ”¶ SDK å‚³å…¥çš„äº‹ä»¶ï¼ŒKafka å„²å­˜è‡³ ClickHouse/Redis ä¾›å³æ™‚/é›¢ç·šåˆ†æž  | è¡Œç‚ºè³‡æ–™æµå…¥ Kafka/ClickHouse  |
| **Profile Service**           | å»ºç«‹èˆ‡æ›´æ–°ç”¨æˆ¶å±¬æ€§ã€æ¨™ç±¤ã€å±¬æ€§åˆ†ç¾¤ï¼ˆå¹´é½¡/æ€§åˆ¥/åå¥½ç­‰ï¼‰              | æä¾›æŽ¨è–¦ã€åˆ†æžæœå‹™ä½¿ç”¨         |
| **Identity Graph Service**    | å»ºç«‹è·¨è¨­å‚™ã€è·¨ç§Ÿæˆ¶çš„åŒ¿å ID â†’ ä½¿ç”¨è€…è­˜åˆ¥æ˜ å°„åœ–ï¼ˆç¶“åˆæ³•æŽˆæ¬Šï¼‰        | å»ºç«‹/æŸ¥è©¢è·¨ç§Ÿæˆ¶è¡Œç‚ºé—œè¯        |
| **Consent Manager**           | ç®¡ç†çµ‚ç«¯ç”¨æˆ¶å°è³‡æ–™è¿½è¹¤èˆ‡åˆ†æžçš„åŒæ„ç‹€æ…‹ï¼ˆCookie Consentã€GDPR é …ç›®ï¼‰ | æŽˆæ¬Šç´€éŒ„ã€å°éŽ–éžæŽˆæ¬Šè³‡æ–™       |
| **Behavior Analytics**        | å³æ™‚è™•ç†ï¼šFlink/ClickHouse æŸ¥è©¢ã€ä½¿ç”¨è€…è½‰æ›/ç•™å­˜åˆ†æž                | æä¾› dashboardã€ä¾›æŽ¨è–¦å¼•æ“Žä½¿ç”¨ |
| **Recommendation Engine**     | ä½¿ç”¨è¡Œç‚ºæ¨¡åž‹ï¼ˆå…§å®¹ã€å”åŒéŽæ¿¾ã€Hybridï¼‰æŽ¨è«–å•†å“ã€æ–‡ç« ã€å…§å®¹æŽ¨è–¦      | æŽ¨è–¦çµæžœå›žå‚³ API/BFF           |
| **Notification Service**      | æ ¹æ“šäº‹ä»¶è¦å‰‡æˆ–æŽ¨è–¦çµæžœç™¼é€é€šçŸ¥ï¼ˆemail/pushï¼‰                        | ä½¿ç”¨é€šçŸ¥æ¨¡æ¿ã€æŽ’ç¨‹æŽ¨æ’­         |
| **Audit & Compliance**        | è¨˜éŒ„æ‰€æœ‰ç”¨æˆ¶è³‡æ–™ä½¿ç”¨ç´€éŒ„èˆ‡æ¨¡åž‹è¨“ç·´æ—¥èªŒï¼Œä»¥ç¬¦åˆæ³•è¦è¦æ±‚              | ç”Ÿæˆç¨½æ ¸å ±è¡¨ã€æ¨¡åž‹ trace log   |

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¡Œç‚ºæ™ºèƒ½å¹³å°æ¨¡çµ„åŒ–æž¶æ§‹è¨­è¨ˆ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… æ ¸å¿ƒåŸºç¤Žæ¨¡çµ„ â”‚
â”‚ â”‚
â”‚ [A1] è¡Œç‚ºäº‹ä»¶æŽ¥æ”¶æ¨¡çµ„ (Tracking API / SDK) â”‚
â”‚ [A2] å¤šç§Ÿæˆ¶æ¬Šé™/è³‡æ–™éš”é›¢æ¨¡çµ„ â”‚
â”‚ [A3] è³‡æ–™è™•ç†ç®¡ç·šæ¨¡çµ„ (Kafka + NiFi) â”‚
â”‚ [A4] ClickHouse è³‡æ–™å„²å­˜èˆ‡åˆ†æžæ¨¡çµ„ â”‚
â”‚ [A5] è¡Œç‚ºæ¨¡åž‹å®šç¾©èˆ‡äº‹ä»¶ç®¡ç†æ¨¡çµ„ (Behavior Definition & Meta Config) â”‚
â”‚ [A6] èº«ä»½æ•´åˆæ¨¡çµ„ (åŒ¿åèˆ‡å·²ç™»å…¥å¸³æˆ¶è­˜åˆ¥æ•´åˆ) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ” è³‡æ–™åˆ†æž/å»ºæ¨¡/æŽ¨è–¦æ¨¡çµ„ â”‚
â”‚ â”‚
â”‚ [B1] è¡Œç‚ºåˆ†ç¾¤å¼•æ“Žï¼ˆUser Segmentation Engineï¼‰ â”‚
â”‚ [B2] è¡Œç‚ºåºåˆ—åœ–è­œåˆ†æžæ¨¡çµ„ï¼ˆPath/Sequence Analysisï¼‰ â”‚
â”‚ [B3] è¡Œç‚ºé—œè¯æŒ–æŽ˜æ¨¡çµ„ï¼ˆCross-Tenant Insight Layerï¼‰ â”‚
â”‚ [B4] å³æ™‚è¦å‰‡å¼è§¸ç™¼æ¨¡çµ„ï¼ˆReal-time Trigger Engineï¼‰ â”‚
â”‚ [B5] æ™ºèƒ½æŽ¨è–¦æ¨¡çµ„ï¼ˆRecommendation Engine with Privacy Filterï¼‰ â”‚
â”‚ [B6] è‡ªè¨‚æ´žå¯Ÿå ±è¡¨æ¨¡çµ„ï¼ˆInsight Builder + Query DSLï¼‰ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ’¡ æ™ºèƒ½æ‡‰ç”¨æ¨¡çµ„ï¼ˆå¯æ­é…ä¸Šå±¤è¡ŒéŠ·/é‹ç‡Ÿå¹³å°ï¼‰ â”‚
â”‚ â”‚
â”‚ [C1] è¡ŒéŠ·æ´»å‹•è‡ªå‹•åŒ–æ¨¡çµ„ï¼ˆä¾‹å¦‚ EDM, LINE, Webhook æŽ¨é€ï¼‰ â”‚
â”‚ [C2] å•†å“æŽ¨è–¦æ¨¡çµ„ï¼ˆå®¢è£½åŒ–å•†å“é æŽ’åºã€å‹•æ…‹ç‰ˆä½ï¼‰ â”‚
â”‚ [C3] å…§å®¹æŽ¨è–¦æ¨¡çµ„ï¼ˆæ ¹æ“šç€è¦½èˆ‡è¡Œç‚ºå‘ˆç¾ä¸åŒå…§å®¹ï¼‰ â”‚
â”‚ [C4] é¡§å®¢ç”Ÿå‘½é€±æœŸé æ¸¬æ¨¡çµ„ï¼ˆLTV, æµå¤±é¢¨éšª, æ´»èºé æ¸¬ï¼‰ â”‚
â”‚ [C5] è·¨ç§Ÿæˆ¶æ´žå¯Ÿæ¨¡çµ„ï¼ˆPrivacy-safe insight aggregatorï¼‰ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ðŸ” æ³•è¦åˆè¦èˆ‡æŽ§åˆ¶æ¨¡çµ„ â”‚
â”‚ â”‚
â”‚ [D1] è³‡æ–™å¯æ”œèˆ‡åˆªé™¤æŽ¥å£ï¼ˆRight to be Forgotten & Portabilityï¼‰ â”‚
â”‚ [D2] èº«ä»½åŒ¿ååŒ–/å½ååŒ–æ©Ÿåˆ¶ï¼ˆPseudonymization/Anonymizationï¼‰ â”‚
â”‚ [D3] æ¨¡åž‹èˆ‡æŽ¨è–¦ä½¿ç”¨é™åˆ¶è¨­å®šï¼ˆç§Ÿæˆ¶è³‡æ–™ä¸å¾—è¢«å¤–éƒ¨æ¨¡åž‹è¨“ç·´ï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

| è§£æ±ºæ–¹æ¡ˆåç¨±                         | é©ç”¨æƒ…å¢ƒ            | åŒ…å«æ¨¡çµ„                                | ç‰¹é»ž                                                       |
| ------------------------------------ | ------------------- | --------------------------------------- | ---------------------------------------------------------- |
| ðŸŽ¯ **è¡ŒéŠ·æ´»å‹•è‡ªå‹•åŒ–å¥—ä»¶**            | é›»å•†ã€SaaS ç”¨æˆ¶ç¶“ç‡Ÿ | A1\~A6 + B1, B4 + C1                    | å¯¦ç¾æ ¹æ“šç”¨æˆ¶è¡Œç‚ºè‡ªå‹•æŽ¨é€ LINE/Email é€šçŸ¥ï¼Œä¸¦æ”¯æ´æ¢ä»¶å¼åˆ†çœ¾ |
| ðŸ›ï¸ **æ™ºæ…§å•†å“æŽ¨è–¦å¥—ä»¶**              | é›»å•†å¹³å°            | A1\~A6 + B1, B5 + C2                    | ä¾ç€è¦½ç´€éŒ„ã€è³¼è²·ç´€éŒ„æŽ¨è–¦å•†å“ï¼Œæ”¯æ´å‹•æ…‹å±•ç¤ºæŽ’åº             |
| ðŸ“ˆ **é¡§å®¢æ´žå¯Ÿèˆ‡é æ¸¬åˆ†æžå¥—ä»¶**        | ç¶“ç‡Ÿ/æˆé•·åœ˜éšŠ       | A1~~A6 + B1~~B3 + C4                    | é æ¸¬æ´»èºåº¦ã€é¡§å®¢æµå¤±ã€åˆ†æžç”¨æˆ¶ç”Ÿå‘½é€±æœŸèˆ‡åƒ¹å€¼               |
| ðŸ¤ **è·¨ç§Ÿæˆ¶è¡Œç‚ºæ´žå¯Ÿå¥—ä»¶**            | B2B SaaSã€å¹³å°å•†    | A1~~A6 + B3 + C5 + D1~~D3               | åœ¨åˆæ³•ç¯„åœå…§åˆ†æžç§Ÿæˆ¶é–“ç”¨æˆ¶è¡Œç‚ºï¼Œç™¼ç¾å…±é€šéœ€æ±‚èˆ‡å»ºè­°è§£æ±ºæ–¹æ¡ˆ |
| ðŸ§  **AI æ¨¡åž‹è‡ªä¸»å­¸ç¿’æ¨¡çµ„**ï¼ˆåŠ å€¼ç‰ˆï¼‰ | é«˜éšŽå¹³å°ç”¨æˆ¶        | ä¸Šè¿°æ‰€æœ‰ + å°ˆå±¬æ¨¡åž‹è¨“ç·´æ¡†æž¶ï¼ˆéš”é›¢ç§Ÿæˆ¶ï¼‰ | å…è¨±ç§Ÿæˆ¶è‡ªè¡Œå®šç¾©æ¨¡åž‹ã€ä¸Šå‚³è³‡æ–™è‡ªè¨“ç·´ï¼Œä¸¦å¥—ç”¨æ–¼æŽ¨è–¦æ¨¡çµ„ä¸­   |
